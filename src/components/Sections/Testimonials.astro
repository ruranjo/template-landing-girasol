---
import { getSheetData, SHEET_TESTIMONIALS_URL } from "../../lib/getSheetData";

const testimonios = [
  {
    nombre: "Mar√≠a Rodr√≠guez",
    cargo: "Directora de Marketing",
    texto: "Leonela transform√≥ por completo nuestra presencia en l√≠nea. La participaci√≥n de nuestra comunidad aument√≥ un 200% en solo 3 meses.",
    estrellas: 5,
    emoji: "üå∏",
  },
  {
    nombre: "Carlos M√©ndez",
    cargo: "Fundador de Startup",
    texto: "Trabajar con Leonela fue una de las mejores decisiones que tomamos. Su enfoque estrat√©gico para la construcci√≥n de comunidades es excepcional.",
    estrellas: 5,
    emoji: "üåû",
  },
  {
    nombre: "Sof√≠a √Ålvarez",
    cargo: "Due√±a de Negocio Peque√±o",
    texto: "Leonela tiene un talento natural para conectarse con las personas. Nos ayud√≥ a construir una comunidad leal alrededor de nuestra marca.",
    estrellas: 4,
    emoji: "üåø",
  },
  {
    nombre: "Diego Fern√°ndez",
    cargo: "Gerente de Ventas",
    texto: "Gracias a Leonela, nuestras conversiones aumentaron significativamente. Su asesor√≠a fue clave para optimizar nuestro embudo de ventas.",
    estrellas: 5,
    emoji: "üêù",
  },
  {
    nombre: "Laura Castillo",
    cargo: "Coach de Bienestar",
    texto: "Su capacidad para conectar con la audiencia es impresionante. Mis redes sociales crecieron y logr√© atraer clientes de manera org√°nica.",
    estrellas: 5,
    emoji: "üçÄ",
  },
  {
    nombre: "Andr√©s Ram√≠rez",
    cargo: "Propietario de E-commerce",
    texto: "Leonela aport√≥ ideas innovadoras que mejoraron la experiencia de nuestros clientes. El tr√°fico y las ventas subieron de inmediato.",
    estrellas: 4,
    emoji: "üåª",
  },
];
const testimonioss = await getSheetData(SHEET_TESTIMONIALS_URL);
---

<section id="testimonials" class="max-w-6xl mx-auto px-6 py-16">
  <h2 class="text-3xl font-bold text-center mb-8">‚ú® Lo que dicen mis clientes</h2>

  <!-- Contenedor carrusel -->
  <div class="relative overflow-hidden">
    <!-- Slides -->
    <div id="carousel-track" class="flex transition-transform duration-500 ease-in-out">
      {testimonioss.map((t) => (
        <div class="w-full md:w-1/2 lg:w-1/3 flex-shrink-0 px-4">
          <div class="bg-white rounded-2xl shadow-md p-6 flex flex-col h-full">
            <!-- Estrellas -->
            <div class="flex text-yellow-400 mb-3">
              {"‚òÖ".repeat(Number(t.estrellas))}{"‚òÜ".repeat(5 - Number(t.estrellas))}
            </div>
            <!-- Texto -->
            <p class="text-gray-700 italic mb-4">"{t.texto}"</p>
            <!-- Nombre con emoji -->
            <p class="font-semibold text-gray-900 mt-auto flex items-center gap-2">
              <span>{t.emoji}</span> {t.nombre}
            </p>
            <p class="text-sm text-gray-500">{t.cargo}</p>
          </div>
        </div>
      ))}
    </div>

    <!-- Botones -->
    <button id="prev" class="absolute top-1/2 -left-4 transform -translate-y-1/2 bg-yellow-500 text-white p-2 rounded-full shadow hover:bg-yellow-600">‚Äπ</button>
    <button id="next" class="absolute top-1/2 -right-4 transform -translate-y-1/2 bg-yellow-500 text-white p-2 rounded-full shadow hover:bg-yellow-600">‚Ä∫</button>
  </div>
</section>

<script>
  const track = document.getElementById("carousel-track");
  const prev = document.getElementById("prev");
  const next = document.getElementById("next");

  let index = 0;
  let autoSlide: any; // referencia al intervalo

  if (track && prev && next) {
    const slideCount = track.children.length;

    const slidesPerView = () => {
      if (window.innerWidth >= 1024) return 3;
      if (window.innerWidth >= 768) return 2;
      return 1;
    };

    function updateCarousel() {
      const totalSlides = slideCount;
      const spv = slidesPerView();
      const maxIndex = totalSlides - spv;
      if (index < 0) index = maxIndex;
      if (index > maxIndex) index = 0;
      const translateX = -(index * (100 / spv));
      if(track){
        track.style.transform = `translateX(${translateX}%)`;
      }
      
    }

    function startAutoSlide() {
      stopAutoSlide(); // prevenir duplicados
      autoSlide = setInterval(() => {
        index++;
        updateCarousel();
      }, 5000); // cada 5s
    }

    function stopAutoSlide() {
      if (autoSlide) clearInterval(autoSlide);
    }

    next.addEventListener("click", () => {
      index++;
      updateCarousel();
      startAutoSlide(); // reinicia el temporizador
    });

    prev.addEventListener("click", () => {
      index--;
      updateCarousel();
      startAutoSlide(); // reinicia el temporizador
    });

    window.addEventListener("resize", updateCarousel);

    // inicializa
    updateCarousel();
    startAutoSlide();
  }
</script>
