---
const testimonios = [
  {
    nombre: "María Rodríguez",
    cargo: "Directora de Marketing",
    texto: "Leonela transformó por completo nuestra presencia en línea. La participación de nuestra comunidad aumentó un 200% en solo 3 meses.",
    estrellas: 5,
    emoji: "🌸",
  },
  {
    nombre: "Carlos Méndez",
    cargo: "Fundador de Startup",
    texto: "Trabajar con Leonela fue una de las mejores decisiones que tomamos. Su enfoque estratégico para la construcción de comunidades es excepcional.",
    estrellas: 5,
    emoji: "🌞",
  },
  {
    nombre: "Sofía Álvarez",
    cargo: "Dueña de Negocio Pequeño",
    texto: "Leonela tiene un talento natural para conectarse con las personas. Nos ayudó a construir una comunidad leal alrededor de nuestra marca.",
    estrellas: 4,
    emoji: "🌿",
  },
  {
    nombre: "Diego Fernández",
    cargo: "Gerente de Ventas",
    texto: "Gracias a Leonela, nuestras conversiones aumentaron significativamente. Su asesoría fue clave para optimizar nuestro embudo de ventas.",
    estrellas: 5,
    emoji: "🐝",
  },
  {
    nombre: "Laura Castillo",
    cargo: "Coach de Bienestar",
    texto: "Su capacidad para conectar con la audiencia es impresionante. Mis redes sociales crecieron y logré atraer clientes de manera orgánica.",
    estrellas: 5,
    emoji: "🍀",
  },
  {
    nombre: "Andrés Ramírez",
    cargo: "Propietario de E-commerce",
    texto: "Leonela aportó ideas innovadoras que mejoraron la experiencia de nuestros clientes. El tráfico y las ventas subieron de inmediato.",
    estrellas: 4,
    emoji: "🌻",
  },
];
---

<section id="testimonials" class="max-w-6xl mx-auto px-6 py-16">
  <h2 class="text-3xl font-bold text-center mb-8">✨ Lo que dicen mis clientes</h2>

  <!-- Contenedor carrusel -->
  <div class="relative overflow-hidden">
    <!-- Slides -->
    <div id="carousel-track" class="flex transition-transform duration-500 ease-in-out">
      {testimonios.map((t) => (
        <div class="w-full md:w-1/2 lg:w-1/3 flex-shrink-0 px-4">
          <div class="bg-white rounded-2xl shadow-md p-6 flex flex-col h-full">
            <!-- Estrellas -->
            <div class="flex text-yellow-400 mb-3">
              {"★".repeat(t.estrellas)}{"☆".repeat(5 - t.estrellas)}
            </div>
            <!-- Texto -->
            <p class="text-gray-700 italic mb-4">"{t.texto}"</p>
            <!-- Nombre con emoji -->
            <p class="font-semibold text-gray-900 mt-auto flex items-center gap-2">
              <span>{t.emoji}</span> {t.nombre}
            </p>
            <p class="text-sm text-gray-500">{t.cargo}</p>
          </div>
        </div>
      ))}
    </div>

    <!-- Botones -->
    <button id="prev" class="absolute top-1/2 -left-4 transform -translate-y-1/2 bg-yellow-500 text-white p-2 rounded-full shadow hover:bg-yellow-600">‹</button>
    <button id="next" class="absolute top-1/2 -right-4 transform -translate-y-1/2 bg-yellow-500 text-white p-2 rounded-full shadow hover:bg-yellow-600">›</button>
  </div>
</section>

<script>
  const track = document.getElementById("carousel-track");
  const prev = document.getElementById("prev");
  const next = document.getElementById("next");

  let index = 0;
  let autoSlide: any; // referencia al intervalo

  if (track && prev && next) {
    const slideCount = track.children.length;

    const slidesPerView = () => {
      if (window.innerWidth >= 1024) return 3;
      if (window.innerWidth >= 768) return 2;
      return 1;
    };

    function updateCarousel() {
      const totalSlides = slideCount;
      const spv = slidesPerView();
      const maxIndex = totalSlides - spv;
      if (index < 0) index = maxIndex;
      if (index > maxIndex) index = 0;
      const translateX = -(index * (100 / spv));
      if(track){
        track.style.transform = `translateX(${translateX}%)`;
      }
      
    }

    function startAutoSlide() {
      stopAutoSlide(); // prevenir duplicados
      autoSlide = setInterval(() => {
        index++;
        updateCarousel();
      }, 5000); // cada 5s
    }

    function stopAutoSlide() {
      if (autoSlide) clearInterval(autoSlide);
    }

    next.addEventListener("click", () => {
      index++;
      updateCarousel();
      startAutoSlide(); // reinicia el temporizador
    });

    prev.addEventListener("click", () => {
      index--;
      updateCarousel();
      startAutoSlide(); // reinicia el temporizador
    });

    window.addEventListener("resize", updateCarousel);

    // inicializa
    updateCarousel();
    startAutoSlide();
  }
</script>
